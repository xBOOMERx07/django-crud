{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="mb-4">
                <a href="{% url 'home' %}" class="btn btn-secondary">
                    <i data-lucide="arrow-left" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                    Volver al Dashboard
                </a>
            </div>
            
            <div class="card">
                <div class="card-body p-4">
                    <h2 class="mb-4">
                        <i data-lucide="user-circle" style="width: 36px; height: 36px; vertical-align: middle;"></i>
                        Datos Personales
                    </h2>
                    
                    {% if error %}
                    <div class="alert alert-danger">
                        {{ error }}
                    </div>
                    {% endif %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>⚠️ Errores en el formulario:</strong>
                        <ul>
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ field.label }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- FOTO DE PERFIL -->
                        <div class="mb-4 text-center">
                            <label class="form-label">
                                <i data-lucide="camera" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                Foto de Perfil
                            </label>
                            
                            <!-- Preview de la foto actual -->
                            <div id="preview-container" class="mb-3">
                                {% if datos.foto_perfil %}
                                <img id="preview-image" src="{{ datos.foto_perfil.url }}" alt="Foto actual" 
                                     style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent-cyan);">
                                {% else %}
                                <div id="preview-image" style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple)); margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                    <i data-lucide="user" style="width: 80px; height: 80px; color: white;"></i>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Zona de drag & drop -->
                            <div id="drop-zone" style="border: 2px dashed var(--glass-border); border-radius: 12px; padding: 2rem; cursor: pointer; transition: all 0.3s ease;">
                                <i data-lucide="upload-cloud" style="width: 48px; height: 48px; color: var(--accent-cyan); margin-bottom: 1rem;"></i>
                                <p class="mb-2">Arrastra tu foto aquí o haz clic para seleccionar</p>
                                <small class="text-muted">Formatos: JPG, PNG, GIF (máx. 5MB)</small>
                            </div>
                            
                            {{ form.foto_perfil }}
                        </div>
                        
                        <hr class="my-4">
                        
                        <!-- PERFIL ACTIVO -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i data-lucide="settings" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                Descripción del Perfil
                            </label>
                            {{ form.descripcion_perfil }}
                            <small class="text-muted">Aparecerá como título en tu CV público</small>
                        </div>
                        
                        <div class="form-check mb-4">
                            {{ form.perfil_activo }}
                            <label class="form-check-label" for="{{ form.perfil_activo.id_for_label }}">
                                <i data-lucide="eye" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                Perfil activo (visible públicamente)
                            </label>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="user" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Nombres *
                                </label>
                                {{ form.nombres }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="user" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Apellidos *
                                </label>
                                {{ form.apellidos }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="credit-card" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Número de Cédula *
                                </label>
                                {{ form.numero_cedula }}
                                <small class="text-muted">10 dígitos</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="user-check" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Sexo *
                                </label>
                                {{ form.sexo }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="calendar" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Fecha de Nacimiento *
                                </label>
                                {{ form.fecha_nacimiento }}
                                <small class="text-muted">Edad: 18-70 años</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="heart" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Estado Civil
                                </label>
                                {{ form.estado_civil }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="flag" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Nacionalidad
                                </label>
                                {{ form.nacionalidad }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="map-pin" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Lugar de Nacimiento
                                </label>
                                {{ form.lugar_nacimiento }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">
                                    <i data-lucide="phone" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Teléfono Convencional
                                </label>
                                {{ form.telefono_convencional }}
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">
                                    <i data-lucide="smartphone" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Teléfono Móvil
                                </label>
                                {{ form.telefono_fijo }}
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">
                                    <i data-lucide="mail" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Email Personal *
                                </label>
                                {{ form.email_personal }}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="home" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Dirección Domiciliaria
                                </label>
                                {{ form.direccion_domiciliaria }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="briefcase" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Dirección de Trabajo
                                </label>
                                {{ form.direccion_trabajo }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                <i data-lucide="car" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                Licencia de Conducir
                            </label>
                            {{ form.licencia_conducir }}
                        </div>
                        
                        <hr class="my-4">
                        <h5 class="mb-3">
                            <i data-lucide="share-2" style="width: 20px; height: 20px; vertical-align: middle;"></i>
                            Redes Sociales
                        </h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="linkedin" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    LinkedIn
                                </label>
                                {{ form.linkedin_url }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="github" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    GitHub
                                </label>
                                {{ form.github_url }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="twitter" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Twitter/X
                                </label>
                                {{ form.twitter_url }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">
                                    <i data-lucide="briefcase" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                    Portafolio Personal
                                </label>
                                {{ form.portfolio_url }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                <i data-lucide="globe" style="width: 16px; height: 16px; vertical-align: middle;"></i>
                                Sitio Web
                            </label>
                            {{ form.sitio_web }}
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i data-lucide="save" style="width: 20px; height: 20px; vertical-align: middle;"></i>
                                Guardar Información
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('{{ form.foto_perfil.id_for_label }}');
        const previewImage = document.getElementById('preview-image');
        
        // Click en la zona activa el input
        dropZone.addEventListener('click', () => fileInput.click());
        
        // Drag & Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--accent-cyan)';
            dropZone.style.backgroundColor = 'rgba(6, 182, 212, 0.1)';
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'var(--glass-border)';
            dropZone.style.backgroundColor = 'transparent';
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--glass-border)';
            dropZone.style.backgroundColor = 'transparent';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                previewFile(files[0]);
            }
        });
        
        // Preview cuando se selecciona archivo
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                previewFile(e.target.files[0]);
            }
        });
        
        // Función para mostrar preview
        function previewFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                if (previewImage.tagName === 'IMG') {
                    previewImage.src = e.target.result;
                } else {
                    const img = document.createElement('img');
                    img.id = 'preview-image';
                    img.src = e.target.result;
                    img.style.cssText = 'width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent-cyan);';
                    previewImage.parentNode.replaceChild(img, previewImage);
                }
            };
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}